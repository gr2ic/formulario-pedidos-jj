<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Cadastro de Pedido</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    .container {
      background-color: white;
      max-width: 600px;
      margin: auto;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h1 {
      text-align: center;
    }
    label {
      font-weight: bold;
    }
    input, select, textarea {
      width: 100%;
      padding: 8px;
      margin-bottom: 12px;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      padding: 10px 20px;
      background-color: black;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .logo {
      display: block;
      margin: 10px auto;
      max-width: 150px;
    }
    .produto-item {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      position: relative;
    }
    .remove-item {
      position: absolute;
      top: 5px;
      right: 5px;
      background: red;
      color: white;
      border: none;
      border-radius: 50%;
      width: 25px;
      height: 25px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <img src="logo-jj.jpg" alt="Logo J&J" class="logo">
    <h1>Cadastro de Pedido</h1>
    <form id="pedidoForm">
      <label>Data do Pedido:</label>
      <input type="date" name="dataPedido" required>

      <label>Vendedor:</label>
      <select name="vendedor" required>
        <option value="">Selecione</option>
        <option>Thalyson</option>
        <option>Moises</option>
        <option>Rafael</option>
        <option>Wilian</option>
        <option>Flaviano</option>
      </select>

      <label>CNPJ do Cliente:</label>
      <input type="text" name="cnpj" id="cnpj" required pattern="\d{14}" placeholder="Somente números">
      <button type="button" onclick="buscarCNPJ()">Buscar Cliente</button>

      <label>Razão Social:</label>
      <input type="text" name="razaoSocial" id="razaoSocial" readonly>

      <label>Nome Fantasia:</label>
      <input type="text" name="nomeFantasia" id="nomeFantasia" readonly>

      <label>Endereço:</label>
      <input type="text" name="endereco" id="endereco" readonly>

      <label>Município:</label>
      <input type="text" name="municipio" id="municipio" readonly>

      <label>UF:</label>
      <input type="text" name="uf" id="uf" readonly>

      <div id="produtosContainer"></div>
      <button type="button" onclick="adicionarProduto()">+ Adicionar Produto</button>

      <label>Condição de Pagamento:</label>
      <select name="condicaoPagamento" required>
        <option value="AVISTA ANTECIPADO">AVISTA ANTECIPADO</option>
        <option value="BOLETO 7 DIAS">BOLETO 7 DIAS</option>
        <option value="BOLETO 14 /21 DIAS">BOLETO 14 /21 DIAS</option>
        <option value="BOLETO 14 / 21 / 28 / 35 DIAS">BOLETO 14 / 21 / 28 / 35 DIAS</option>
        <option value="BOLETO 21 / 28 / 35 / 42 / 49 DIAS">BOLETO 21 / 28 / 35 / 42 / 49 DIAS</option>
      </select>

      <label>Formato de Entrega:</label>
      <label><input type="radio" name="formatoEntrega" value="CIF" required> CIF</label>
      <label><input type="radio" name="formatoEntrega" value="FOB" required> FOB</label>

      <label>Observações:</label>
      <textarea name="observacoes"></textarea>

      <button type="submit">Enviar Pedido</button>
    </form>
  </div>

  <script>
    const produtos = [
      '1 - Realengo TP 1 6x5 Parboilizado',
      '3 - Realengo TP 1 30x1 Parboilizado',
      '642 - Realengo Polido 6x5',
      '643 - Realengo Polido 30x1',
      '1110 - Arroz P/ Cães 6x5',
      '8291 - Arroz Parboilizado 25Kg TP 1',
      '8295 - Arroz Polido TP 1 SC 25Kg',
      '1128 - Realengo TP 1 SC 50Kg Parboilizado',
      '1200 - Realengo TP 1 SC 50Kg Polido',
      '8899 - Arroz Realengo Integral 10x1',
      '13 - Realengo Parboilizado TP 1 - 10x1',
      '8151 - Arroz Realengo Branco 10x1'
    ];

    function adicionarProduto() {
      const container = document.getElementById('produtosContainer');
      const index = container.children.length;

      const div = document.createElement('div');
      div.className = 'produto-item';

      let html = `
        <label>Produto:</label>
        <select name="produto" required>
          ${produtos.map(p => `<option value="${p}">${p}</option>`).join('')}
        </select>
        <label>Quantidade:</label>
        <input type="number" name="quantidade" required>
        <label>Preço Unitário:</label>
        <input type="number" name="precoUnitario" step="0.01" required>
      `;

      if (index > 0) {
        html += `<button type="button" class="remove-item" onclick="this.parentNode.remove()">×</button>`;
      }

      div.innerHTML = html;
      container.appendChild(div);
    }

    adicionarProduto(); // Adiciona o primeiro item por padrão

    async function buscarCNPJ() {
      const cnpj = document.getElementById('cnpj').value.replace(/\D/g, '');
      if (cnpj.length !== 14) return alert('CNPJ inválido.');

      const res = await fetch(`https://brasilapi.com.br/api/cnpj/v1/${cnpj}`);
      const data = await res.json();

      if (data.nome) {
        document.getElementById('razaoSocial').value = data.razao_social || '';
        document.getElementById('nomeFantasia').value = data.nome_fantasia || '';
        document.getElementById('endereco').value = `${data.logradouro}, ${data.numero} ${data.bairro}`;
        document.getElementById('municipio').value = data.municipio || '';
        document.getElementById('uf').value = data.uf || '';
      } else {
        alert('CNPJ não encontrado.');
      }
    }

    document.getElementById('pedidoForm').addEventListener('submit', async function(e) {
      e.preventDefault();

      const form = e.target;
      const produtosContainer = document.getElementById('produtosContainer');
      const produtosNodes = produtosContainer.querySelectorAll('.produto-item');

      const produtos = Array.from(produtosNodes).map(node => ({
        nome: node.querySelector('select[name="produto"]').value,
        quantidade: node.querySelector('input[name="quantidade"]').value,
        precoUnitario: node.querySelector('input[name="precoUnitario"]').value
      }));

      const data = {
        dataPedido: form.dataPedido.value,
        vendedor: form.vendedor.value,
        cnpj: form.cnpj.value,
        razaoSocial: form.razaoSocial.value,
        nomeFantasia: form.nomeFantasia.value,
        endereco: form.endereco.value,
        municipio: form.municipio.value,
        uf: form.uf.value,
        condicaoPagamento: form.condicaoPagamento.value,
        formatoEntrega: form.formatoEntrega.value,
        observacoes: form.observacoes.value,
        produtos
      };

      const url = 'https://script.google.com/macros/s/AKfycbzvEeln2NhLY31ZL4LF5X6PJ48dzBn1B0hXBPy23vNrHeIEeyH1_hTCd_pqcdMa7ELU-g/exec';
      const response = await fetch(url, {
        method: 'POST',
        body: JSON.stringify(data),
        headers: { 'Content-Type': 'application/json' }
      });

      const result = await response.json();
      if (result.success) {
        alert('Pedido enviado com sucesso!');
        form.reset();
        produtosContainer.innerHTML = '';
        adicionarProduto();
      } else {
        alert('Erro ao enviar pedido.');
      }
    });
  </script>
</body>
</html>
